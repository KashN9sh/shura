# Улучшенный RBC Counter

Приложение для подсчета эритроцитов на микроскопических изображениях с поддержкой различных типов окрашивания.

## Новые возможности

### Автоматическое определение типа изображения
Приложение теперь автоматически определяет тип микроскопического изображения и применяет соответствующий алгоритм:

1. **Эритроциты с фиолетовыми ядрами** - классический тип с четко выраженными ядрами
2. **Однородные эритроциты** - эритроциты с равномерной окраской (пурпурные/малиновые)
3. **Смешанный тип** - комбинированный алгоритм для сложных случаев

### Улучшенный алгоритм для однородных эритроцитов
- Расширенный диапазон цветов HSV для детекции пурпурных/малиновых эритроцитов
- Адаптированные параметры фильтрации по размеру и форме
- Улучшенные морфологические операции для очистки изображения

### Ключевые улучшения
- **Анализ цветового профиля** - автоматическое определение типа изображения
- **Гибкие параметры** - разные настройки для разных типов эритроцитов
- **Улучшенная точность** - более точный подсчет на изображениях с однородными эритроцитами
- **Совместимость** - сохраняет работу с классическими изображениями

## Технические детали

### Алгоритм анализа типа изображения
```kotlin
private fun analyzeImageType(bitmap: Bitmap): ImageType {
    // Сэмплирование пикселей для анализа цветового профиля
    // Определение соотношения фиолетовых ядер vs однородных эритроцитов
    // Автоматический выбор оптимального алгоритма
}
```

### Маска для однородных эритроцитов
```kotlin
private fun maskUniformCells(bitmap: Bitmap): BooleanArray {
    // HSV диапазоны: пурпурный (300-360°), красный (0-30°), магента (270-300°)
    // Насыщенность >= 0.25, яркость >= 0.15
}
```

## Использование

1. Запустите приложение
2. Выберите микроскопическое изображение
3. Приложение автоматически определит тип изображения и применит оптимальный алгоритм
4. Результат подсчета отобразится с белыми обводками вокруг найденных эритроцитов

## Совместимость
- Android 6.0+ (API 23+)
- Поддержка различных форматов изображений
- Автоматическая обработка разрешений для доступа к галерее
