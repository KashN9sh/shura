# Улучшенный RBC Counter

Приложение для подсчета эритроцитов на микроскопических изображениях с поддержкой различных типов окрашивания.

## Новые возможности

### Автоматическое определение типа изображения
Приложение теперь автоматически определяет тип микроскопического изображения и применяет соответствующий алгоритм:

1. **Эритроциты с фиолетовыми ядрами** - классический тип с четко выраженными ядрами
2. **Однородные эритроциты** - эритроциты с равномерной окраской (пурпурные/малиновые)
3. **Смешанный тип** - комбинированный алгоритм для сложных случаев

### Улучшенный алгоритм для однородных эритроцитов
- Расширенный диапазон цветов HSV для детекции пурпурных/малиновых эритроцитов
- Адаптированные параметры фильтрации по размеру и форме
- Улучшенные морфологические операции для очистки изображения

### Ключевые улучшения
- **Анализ цветового профиля** - автоматическое определение типа изображения
- **Гибкие параметры** - разные настройки для разных типов эритроцитов
- **Улучшенная точность** - более точный подсчет на изображениях с однородными эритроцитами
- **Совместимость** - сохраняет работу с классическими изображениями

## Технические детали

### Алгоритм анализа типа изображения
```kotlin
private fun analyzeImageType(bitmap: Bitmap): ImageType {
    // Сэмплирование пикселей для анализа цветового профиля
    // Определение соотношения фиолетовых ядер vs однородных эритроцитов
    // Автоматический выбор оптимального алгоритма
}
```

### Маска для однородных эритроцитов
```kotlin
private fun maskUniformCells(bitmap: Bitmap): BooleanArray {
    // HSV диапазоны: пурпурный (300-360°), красный (0-30°), магента (270-300°)
    // Насыщенность >= 0.25, яркость >= 0.15
}
```

## Использование

1. Запустите приложение
2. Выберите микроскопическое изображение
3. Приложение автоматически определит тип изображения и применит оптимальный алгоритм
4. Результат подсчета отобразится с белыми обводками вокруг найденных эритроцитов

## Сборка и запуск

### Требования
- **JDK 17+** (для сборки нужна Java 11 или новее; рекомендуется 17)
- Android: Android Studio или командная строка с `ANDROID_HOME`
- macOS/Desktop: для десктопной версии достаточно JDK 17

### Android
```bash
./gradlew :app:assembleDebug
# или запуск на устройстве/эмуляторе
./gradlew :app:installDebug
```

### Версия для macOS (и других desktop)
Проект собран как Kotlin Multiplatform (KMP) с Compose Multiplatform. Десктопная версия собирается и запускается так:

```bash
# Запуск приложения в окне (macOS/Windows/Linux)
./gradlew :app:run

# Сборка дистрибутива для текущей ОС (например, .dmg для macOS)
./gradlew :app:packageDistributionForCurrentOS
```

Артефакты появятся в `app/build/compose/binaries/`. Для macOS потребуется JDK 17+ в `JAVA_HOME`.

## Совместимость
- Android 6.0+ (API 23+)
- macOS / Windows / Linux (desktop через Compose Multiplatform)
- Поддержка различных форматов изображений
- Автоматическая обработка разрешений для доступа к галерее (Android)
